# 第一章 单行Perl简介

130个解决问题的程序



单行Perl是小巧的Perl程序，一般是单行代码。它擅长解决的问题包括更改行距，对行编号，执行计算，转换和替换文本，删除和打印特定行，解析日志，就地编辑文件，计算统计信息，执行系统管理任务或一次更新一堆文件。单行Perl将使您成为一个空壳战士：以前需要几分钟（甚至几小时）解决的问题，现在只需要几秒钟！

在本介绍性章节中，我将向您展示单行Perl是什么，并带您领略本书其余部分的内容。本书需要一些Perl知识，但是大多数单行代码可以在不深入了解该语言的情况下进行调整和修改。

让我们看一些例子。比如：

```perl
perl -pi -e 's/you/me/g' file
```

这行代码实现的功能是将file文件文本中所有的*you*替换成*me*。假设您在远程服务器上，并且需要替换文件中的文本。您可以在文本编辑器中打开文件并执行查找-替换，也可以仅通过命令行执行替换，然后Bam一下子就完成该操作。

该单行代码和本书中的其他代码在**UNIX**系统上运行良好。我正在使用Perl 5.8来运行它们，但是它们也可以在更新的Perl版本中使用，例如Perl 5.10和更高版本。如果您使用的是Windows计算机，则需要对其进行一些更改。 要使此单行代码在Windows上工作，请将单引号替换为双引号。要了解有关在Windows上使用Perl单行代码的更多信息，请参阅附录B。

在整本书中，我将使用Perl的**-e**命令行参数。 它允许您使用命令行指定要执行的Perl代码。在前面的单行代码中，代码显示为“执行替换（*s/you/me/g*命令），然后全局将*you*替换为*me*（*/g*标志）。” **-p**参数确保在输入的每一行上执行代码，并确保在执行后打印该行。**-i**参数确保文件被就地编辑。就地编辑意味着Perl直接在文件中执行所有替换，从而覆盖要替换的内容。我建议您始终通过为**-i**参数指定备份扩展名来备份正在使用的文件，如下所示：

```perl
perl -pi.bak -e 's/you/me/g' file
```

现在，Perl首先创建一个*file.bak*备份文件，然后才更改*file*文件的内容。

如何在多个文件中执行相同的替换？ 只需在命令行上指定文件：

```perl
perl -pi -e 's/you/me/g' file1 file2 file3
```

在这里，Perl首先在*file1*中将*you*替换为*me*，然后在file2和file3中执行相同的操作。

您也可以只在匹配*we*的行上执行相同的替换，就像这样：

```perl
perl -pi -e 's/you/me/g if /we/' file
```

在这里，使用条件*if /we/*来确保*s /you/me/g*仅在与正则表达式*/we/*匹配的行上执行。

正则表达式可以是任何东西。 假设您只想对包含数字的行执行替换。 您可以使用/\d/正则表达式来匹配数字：

```perl
perl -pi -e 's/you/me/g if /\d/' file
```

如何查找文件中出现多次的行？

```perl
perl -ne 'print if $a{$_}++' file
```

这行代码可将您到目前为止看到的行记录在*％a*哈希中，并计算它看到这些行的次数。如果已经看过该行，则条件*$a{$_}++*为真，因此它将打印该行。否则，它将“自动”创建一个元素，当前行保存在在*％a*哈希中，并增加其值。特殊变量*$_*包含当前行。这个单行代码还使用*-n*命令行参数来循环输入，但是与*-p*不同，它不会自动打印行。

如何对行进行编号？ 超级简单! Perl的*$.* 特殊变量保持当前行号。 只需将其与行一起打印即可：

```perl
perl -ne 'print "$. $_"' file
```

您可以通过使用*-p*参数并修改*$_*变量来执行相同的操作：

```perl
perl -pe '$_ = "$. $_"' file
```



如果在单行结尾处省略文件名，则Perl将从标准输入中读取数据。 从现在开始，我将假定数据来自标准输入，并将文件名放在最后。 如果要在整个文件上运行单行，则可以随时将其放回去。

您还可以结合前两个单行perl创建仅对重复行编号的代码：

```perl
perl -ne 'print "$. $_" if $a{$_}++'
```

您可以做的另一件事是使用**List :: Util** CPAN模块中的sum函数对每一行中的数字求和。CPAN (Comprehensive Perl Archive Network; *http://www.cpan.org/*)是超过100,000个可重复使用的Perl模块的档案。**List :: Util**是CPAN上的模块之一，它包含各种list实用程序功能。您不需要安装此模块，因为它是Perl随附的（它在Perl内核中）。

```perl
perl -MList::Util=sum -alne 'print sum @F'
```

